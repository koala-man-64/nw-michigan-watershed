{
  "info": {
    "name": "NW Michigan Watershed Coalition — Azure Functions API",
    "_postman_id": "f0a6b2d2-9e1a-44b3-8b3a-6d7c2a9b0b11",
    "schema": "https://schema.getpostman.com/json/collection/v2.1.0/collection.json",
    "description": "Requests for `api/function_app.py` routes.\n\n- Local: set `baseUrl` to `localBaseUrl` (default)\n- Dev/Prod: set `baseUrl` to `devBaseUrl` / `prodBaseUrl`\n\nRoutes:\n- `POST /api/chat-rudy`\n- `GET|POST /api/hello`\n- `GET|POST /api/read-csv`\n- `POST /api/log-event`"
  },
  "item": [
    {
      "name": "chat-rudy — POST (200)",
      "request": {
        "method": "POST",
        "header": [
          { "key": "Content-Type", "value": "application/json" },
          { "key": "Accept", "value": "application/json" }
        ],
        "body": {
          "mode": "raw",
          "raw": "{\n  \"message\": \"{{chat_message}}\"\n}",
          "options": { "raw": { "language": "json" } }
        },
        "url": "{{baseUrl}}/api/chat-rudy"
      },
      "event": [
        {
          "listen": "test",
          "script": {
            "type": "text/javascript",
            "exec": [
              "pm.test('Status is 200', function () { pm.response.to.have.status(200); });",
              "pm.test('Content-Type is JSON', function () {",
              "  const ct = (pm.response.headers.get('Content-Type') || '').toLowerCase();",
              "  pm.expect(ct).to.include('application/json');",
              "});",
              "const body = pm.response.json();",
              "pm.test('ok=true', function () { pm.expect(body.ok).to.eql(true); });",
              "pm.test('Echoes message', function () { pm.expect(body.message).to.eql(pm.collectionVariables.get('chat_message')); });",
              "pm.test('Has reply', function () { pm.expect(body.reply || '').to.be.a('string').and.to.have.length.above(0); });"
            ]
          }
        }
      ]
    },
    {
      "name": "hello — GET (200)",
      "request": {
        "method": "GET",
        "header": [],
        "url": "{{baseUrl}}/api/hello?name={{hello_name}}"
      },
      "event": [
        {
          "listen": "test",
          "script": {
            "type": "text/javascript",
            "exec": [
              "pm.test('Status is 200', function () { pm.response.to.have.status(200); });",
              "pm.test('Body includes name', function () { pm.expect(pm.response.text()).to.include(pm.collectionVariables.get('hello_name')); });"
            ]
          }
        }
      ]
    },
    {
      "name": "hello — POST JSON (200)",
      "request": {
        "method": "POST",
        "header": [{ "key": "Content-Type", "value": "application/json" }],
        "body": {
          "mode": "raw",
          "raw": "{\n  \"name\": \"{{hello_name}}\"\n}",
          "options": { "raw": { "language": "json" } }
        },
        "url": "{{baseUrl}}/api/hello"
      },
      "event": [
        {
          "listen": "test",
          "script": {
            "type": "text/javascript",
            "exec": [
              "pm.test('Status is 200', function () { pm.response.to.have.status(200); });",
              "pm.test('Body includes name', function () { pm.expect(pm.response.text()).to.include(pm.collectionVariables.get('hello_name')); });"
            ]
          }
        }
      ]
    },
    {
      "name": "hello — GET missing name (400)",
      "request": {
        "method": "GET",
        "header": [],
        "url": "{{baseUrl}}/api/hello"
      },
      "event": [
        {
          "listen": "test",
          "script": {
            "type": "text/javascript",
            "exec": [
              "pm.test('Status is 400', function () { pm.response.to.have.status(400); });",
              "pm.test('Body asks for name', function () { pm.expect(pm.response.text()).to.include(\"Please pass a 'name'\"); });"
            ]
          }
        }
      ]
    },
    {
      "name": "read-csv — missing blob (400)",
      "request": {
        "method": "GET",
        "header": [{ "key": "Accept", "value": "application/json" }],
        "url": "{{baseUrl}}/api/read-csv?format=json"
      },
      "event": [
        {
          "listen": "test",
          "script": {
            "type": "text/javascript",
            "exec": [
              "pm.test('Status is 400', function () { pm.response.to.have.status(400); });",
              "const body = pm.response.json();",
              "pm.test('Has error', function () { pm.expect(body).to.have.property('error'); });"
            ]
          }
        }
      ]
    },
    {
      "name": "read-csv — forbidden blob (403; no storage needed)",
      "request": {
        "method": "GET",
        "header": [{ "key": "Accept", "value": "application/json" }],
        "url": "{{baseUrl}}/api/read-csv?blob={{read_csv_forbidden_blob}}&format=json"
      },
      "event": [
        {
          "listen": "test",
          "script": {
            "type": "text/javascript",
            "exec": [
              "pm.test('Status is 403', function () { pm.response.to.have.status(403); });",
              "const body = pm.response.json();",
              "pm.test('Error is Blob not allowed', function () { pm.expect(body.error).to.eql('Blob not allowed'); });"
            ]
          }
        }
      ]
    },
    {
      "name": "read-csv — allowlisted blob JSON (200; requires storage config)",
      "request": {
        "method": "GET",
        "header": [{ "key": "Accept", "value": "application/json" }],
        "url": "{{baseUrl}}/api/read-csv?blob={{read_csv_allowlisted_blob}}&format=json"
      },
      "event": [
        {
          "listen": "test",
          "script": {
            "type": "text/javascript",
            "exec": [
              "pm.test('Status is 200 or 500 (missing storage)', function () {",
              "  pm.expect([200, 500]).to.include(pm.response.code);",
              "});",
              "if (pm.response.code === 200) {",
              "  const ct = (pm.response.headers.get('Content-Type') || '').toLowerCase();",
              "  pm.test('Content-Type is JSON', function () { pm.expect(ct).to.include('application/json'); });",
              "  const data = pm.response.json();",
              "  pm.test('Response is an array', function () { pm.expect(data).to.be.an('array'); });",
              "} else {",
              "  const body = pm.response.json();",
              "  pm.test('Has error', function () { pm.expect(body).to.have.property('error'); });",
              "}"
            ]
          }
        }
      ]
    },
    {
      "name": "log-event — unauthenticated (401; no SQL needed)",
      "request": {
        "method": "POST",
        "header": [
          { "key": "Content-Type", "value": "application/json" },
          { "key": "Accept", "value": "application/json" }
        ],
        "body": {
          "mode": "raw",
          "raw": "{\n  \"eventType\": \"click\",\n  \"targetTag\": \"button\",\n  \"targetId\": \"sample\",\n  \"targetClasses\": \"btn\",\n  \"targetText\": \"\",\n  \"clientUrl\": \"{{log_event_client_url}}\"\n}",
          "options": { "raw": { "language": "json" } }
        },
        "url": "{{baseUrl}}/api/log-event"
      },
      "event": [
        {
          "listen": "test",
          "script": {
            "type": "text/javascript",
            "exec": [
              "pm.test('Status is 401', function () { pm.response.to.have.status(401); });",
              "const body = pm.response.json();",
              "pm.test('Has error', function () { pm.expect(body).to.have.property('error'); });"
            ]
          }
        }
      ]
    },
    {
      "name": "log-event — authenticated (200/429/500; requires SQL + config)",
      "request": {
        "method": "POST",
        "header": [
          { "key": "Content-Type", "value": "application/json" },
          { "key": "Accept", "value": "application/json" },
          { "key": "x-ms-client-principal", "value": "{{swaClientPrincipalB64}}" }
        ],
        "body": {
          "mode": "raw",
          "raw": "{\n  \"eventType\": \"click\",\n  \"targetTag\": \"button\",\n  \"targetId\": \"sample\",\n  \"targetClasses\": \"btn\",\n  \"targetText\": \"\",\n  \"clientUrl\": \"{{log_event_client_url}}\"\n}",
          "options": { "raw": { "language": "json" } }
        },
        "url": "{{baseUrl}}/api/log-event"
      },
      "event": [
        {
          "listen": "test",
          "script": {
            "type": "text/javascript",
            "exec": [
              "pm.test('Status is 200/429/500', function () { pm.expect([200, 429, 500]).to.include(pm.response.code); });",
              "pm.test('JSON response', function () {",
              "  const ct = (pm.response.headers.get('Content-Type') || '').toLowerCase();",
              "  pm.expect(ct).to.include('application/json');",
              "});",
              "const body = pm.response.json();",
              "pm.test('Has status or error', function () {",
              "  pm.expect(body).to.satisfy(b => Object.prototype.hasOwnProperty.call(b, 'status') || Object.prototype.hasOwnProperty.call(b, 'error'));",
              "});"
            ]
          }
        }
      ]
    }
  ],
  "variable": [
    { "key": "baseUrl", "value": "http://localhost:7071" },
    { "key": "localBaseUrl", "value": "http://localhost:7071" },
    { "key": "devBaseUrl", "value": "https://<your-dev-function-app>.azurewebsites.net" },
    { "key": "prodBaseUrl", "value": "https://<your-prod-function-app>.azurewebsites.net" },
    { "key": "hello_name", "value": "Rudy" },
    { "key": "chat_message", "value": "Hello from Postman" },
    { "key": "read_csv_forbidden_blob", "value": "not-allowed.csv" },
    { "key": "read_csv_allowlisted_blob", "value": "locations.csv" },
    { "key": "log_event_client_url", "value": "http://localhost:3000/" },
    {
      "key": "swaClientPrincipalB64",
      "value": "eyJpZGVudGl0eVByb3ZpZGVyIjoibG9jYWwiLCJ1c2VySWQiOiIwMDAwMDAwMC0wMDAwLTAwMDAtMDAwMC0wMDAwMDAwMDAwMDAiLCJ1c2VyRGV0YWlscyI6ImxvY2FsIiwidXNlclJvbGVzIjpbImF1dGhlbnRpY2F0ZWQiXX0="
    }
  ]
}
