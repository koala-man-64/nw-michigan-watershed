{"ast":null,"code":"import React,{useEffect,useState}from'react';import{MapContainer,TileLayer,Marker,Popup,useMap}from'react-leaflet';import L from'leaflet';import Papa from'papaparse';import'leaflet/dist/leaflet.css';// Fix default icon issue in Leaflet with Webpack\nimport{jsx as _jsx,jsxs as _jsxs}from\"react/jsx-runtime\";delete L.Icon.Default.prototype._getIconUrl;L.Icon.Default.mergeOptions({iconRetinaUrl:require('leaflet/dist/images/marker-icon-2x.png'),iconUrl:require('leaflet/dist/images/marker-icon.png'),shadowUrl:require('leaflet/dist/images/marker-shadow.png')});// Component to set initial bounds when map is created\nfunction SetMapBounds(_ref){let{bounds}=_ref;const map=useMap();useEffect(()=>{if(bounds&&bounds.isValid()){map.fitBounds(bounds,{padding:[20,20]});}// Run only once at mount time\n// eslint-disable-next-line react-hooks/exhaustive-deps\n},[map,bounds]);return null;}function MapPanel(_ref2){let{selectedSites}=_ref2;const[allLocations,setAllLocations]=useState([]);// Azure Blob Storage configuration variables\nconst storageAccountName=\"ppastorageaccount159\";const sasToken=\"sv=2024-11-04&ss=bfqt&srt=sco&sp=rwd&se=2045-03-20T12:52:05Z&st=2025-03-13T04:52:05Z&spr=https,http&sig=7lAkSTM%2F7Gd4RCmeLiUXqAfNsWYrZx65sJnnrFDAxpo%3D\";const containerName=\"nwmiws\";// Load all locations from locations.csv in Azure Blob Storage on mount.\nuseEffect(()=>{const url=`https://${storageAccountName}.blob.core.windows.net/${containerName}/locations.csv?${sasToken}`;fetch(url).then(response=>response.text()).then(csvText=>{Papa.parse(csvText,{header:true,skipEmptyLines:true,complete:result=>{// Assume CSV has columns: id, name, latitude, longitude (adjust field names if needed)\nconst locations=result.data.map(row=>({name:row.name||row.Location,lat:parseFloat(row.latitude)||parseFloat(row.Latitude),lng:parseFloat(row.longitude)||parseFloat(row.Longitude)})).filter(loc=>!isNaN(loc.lat)&&!isNaN(loc.lng));setAllLocations(locations);}});}).catch(error=>{console.error(\"Error loading locations CSV:\",error);});},[storageAccountName,containerName,sasToken]);// Filter locations that are selected (based on name)\nconst selectedLocations=allLocations.filter(loc=>selectedSites.includes(loc.name));// Calculate bounds based on selected locations if available.\nlet bounds=null;if(selectedLocations.length>0){bounds=L.latLngBounds(selectedLocations.map(loc=>[loc.lat,loc.lng]));}// Default center and zoom when no datapoints are selected.\nconst defaultCenter=[42.5,-86.0];// adjust as needed\nconst defaultZoom=8;return/*#__PURE__*/_jsxs(MapContainer,{style:{height:'100%',width:'100%'},center:bounds?undefined:defaultCenter,zoom:bounds?undefined:defaultZoom,scrollWheelZoom:true,children:[/*#__PURE__*/_jsx(TileLayer,{url:\"https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png\",attribution:\"\\xA9 OpenStreetMap contributors\"}),bounds&&/*#__PURE__*/_jsx(SetMapBounds,{bounds:bounds}),selectedLocations.map((loc,index)=>/*#__PURE__*/_jsx(Marker,{position:[loc.lat,loc.lng],children:/*#__PURE__*/_jsx(Popup,{children:loc.name})},index))]});}export default MapPanel;","map":{"version":3,"names":["React","useEffect","useState","MapContainer","TileLayer","Marker","Popup","useMap","L","Papa","jsx","_jsx","jsxs","_jsxs","Icon","Default","prototype","_getIconUrl","mergeOptions","iconRetinaUrl","require","iconUrl","shadowUrl","SetMapBounds","_ref","bounds","map","isValid","fitBounds","padding","MapPanel","_ref2","selectedSites","allLocations","setAllLocations","storageAccountName","sasToken","containerName","url","fetch","then","response","text","csvText","parse","header","skipEmptyLines","complete","result","locations","data","row","name","Location","lat","parseFloat","latitude","Latitude","lng","longitude","Longitude","filter","loc","isNaN","catch","error","console","selectedLocations","includes","length","latLngBounds","defaultCenter","defaultZoom","style","height","width","center","undefined","zoom","scrollWheelZoom","children","attribution","index","position"],"sources":["C:/Users/rdpro/Projects/NW Michigan Watershed Coalition/client/src/MapPanel.js"],"sourcesContent":["import React, { useEffect, useState } from 'react';\r\nimport { MapContainer, TileLayer, Marker, Popup, useMap } from 'react-leaflet';\r\nimport L from 'leaflet';\r\nimport Papa from 'papaparse';\r\nimport 'leaflet/dist/leaflet.css';\r\n\r\n// Fix default icon issue in Leaflet with Webpack\r\ndelete L.Icon.Default.prototype._getIconUrl;\r\nL.Icon.Default.mergeOptions({\r\n  iconRetinaUrl: require('leaflet/dist/images/marker-icon-2x.png'),\r\n  iconUrl: require('leaflet/dist/images/marker-icon.png'),\r\n  shadowUrl: require('leaflet/dist/images/marker-shadow.png'),\r\n});\r\n\r\n// Component to set initial bounds when map is created\r\nfunction SetMapBounds({ bounds }) {\r\n  const map = useMap();\r\n  useEffect(() => {\r\n    if (bounds && bounds.isValid()) {\r\n      map.fitBounds(bounds, { padding: [20, 20] });\r\n    }\r\n    // Run only once at mount time\r\n    // eslint-disable-next-line react-hooks/exhaustive-deps\r\n  }, [map, bounds]);\r\n  return null;\r\n}\r\n\r\nfunction MapPanel({ selectedSites }) {\r\n  const [allLocations, setAllLocations] = useState([]);\r\n\r\n  // Azure Blob Storage configuration variables\r\n  const storageAccountName = \"ppastorageaccount159\";\r\n  const sasToken = \"sv=2024-11-04&ss=bfqt&srt=sco&sp=rwd&se=2045-03-20T12:52:05Z&st=2025-03-13T04:52:05Z&spr=https,http&sig=7lAkSTM%2F7Gd4RCmeLiUXqAfNsWYrZx65sJnnrFDAxpo%3D\";\r\n  const containerName = \"nwmiws\";\r\n  \r\n  // Load all locations from locations.csv in Azure Blob Storage on mount.\r\n  useEffect(() => {\r\n    const url = `https://${storageAccountName}.blob.core.windows.net/${containerName}/locations.csv?${sasToken}`;\r\n    fetch(url)\r\n      .then(response => response.text())\r\n      .then(csvText => {\r\n        Papa.parse(csvText, {\r\n          header: true,\r\n          skipEmptyLines: true,\r\n          complete: (result) => {\r\n            // Assume CSV has columns: id, name, latitude, longitude (adjust field names if needed)\r\n            const locations = result.data.map(row => ({\r\n              name: row.name || row.Location, \r\n              lat: parseFloat(row.latitude) || parseFloat(row.Latitude),\r\n              lng: parseFloat(row.longitude) || parseFloat(row.Longitude)\r\n            })).filter(loc => !isNaN(loc.lat) && !isNaN(loc.lng));\r\n            setAllLocations(locations);\r\n          }\r\n        });\r\n      })\r\n      .catch(error => {\r\n        console.error(\"Error loading locations CSV:\", error);\r\n      });\r\n  }, [storageAccountName, containerName, sasToken]);\r\n\r\n  // Filter locations that are selected (based on name)\r\n  const selectedLocations = allLocations.filter(loc => selectedSites.includes(loc.name));\r\n\r\n  // Calculate bounds based on selected locations if available.\r\n  let bounds = null;\r\n  if (selectedLocations.length > 0) {\r\n    bounds = L.latLngBounds(selectedLocations.map(loc => [loc.lat, loc.lng]));\r\n  }\r\n\r\n  // Default center and zoom when no datapoints are selected.\r\n  const defaultCenter = [42.5, -86.0]; // adjust as needed\r\n  const defaultZoom = 8;\r\n\r\n  return (\r\n    <MapContainer\r\n      style={{ height: '100%', width: '100%' }}\r\n      center={bounds ? undefined : defaultCenter}\r\n      zoom={bounds ? undefined : defaultZoom}\r\n      scrollWheelZoom={true}\r\n    >\r\n      <TileLayer\r\n        url=\"https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png\"\r\n        attribution=\"&copy; OpenStreetMap contributors\"\r\n      />\r\n      {/* Fit bounds only when selected locations exist */}\r\n      {bounds && <SetMapBounds bounds={bounds} />}\r\n      {selectedLocations.map((loc, index) => (\r\n        <Marker key={index} position={[loc.lat, loc.lng]}>\r\n          <Popup>{loc.name}</Popup>\r\n        </Marker>\r\n      ))}\r\n    </MapContainer>\r\n  );\r\n}\r\n\r\nexport default MapPanel;"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}